<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>E-go Admin Panel</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h1 { color: #2c3e50; }
    table { border-collapse: collapse; width: 100%; margin-bottom: 20px; }
    table, th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background: #f4f4f4; }
    button { margin: 4px; padding: 5px 10px; cursor: pointer; }
    input { padding: 4px; margin: 2px; }
  </style>
</head>
<body>

  <h1>üöç E-go Admin Dashboard</h1>

  <!-- Passengers -->
  <h2>Passengers</h2>
  <form id="passengerForm">
    <input type="text" id="pName" placeholder="Name" required>
    <input type="email" id="pEmail" placeholder="Email" required>
    <button type="submit">Add Passenger</button>
  </form>
  <table id="passengerTable">
    <thead>
      <tr><th>ID</th><th>Name</th><th>Email</th><th>Actions</th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <!-- Bookings -->
  <h2>Bookings</h2>
  <form id="bookingForm">
    <input type="number" id="bPassengerId" placeholder="Passenger ID" required>
    <input type="text" id="bRoute" placeholder="Route" required>
    <input type="text" id="bSeat" placeholder="Seat" required>
    <button type="submit">Add Booking</button>
  </form>
  <table id="bookingTable">
    <thead>
      <tr><th>ID</th><th>Passenger ID</th><th>Route</th><th>Seat</th><th>Actions</th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <!-- Payments -->
  <h2>Payments</h2>
  <form id="paymentForm">
    <input type="number" id="payBookingId" placeholder="Booking ID" required>
    <input type="number" step="0.01" id="payAmount" placeholder="Amount" required>
    <input type="text" id="payStatus" placeholder="Status" required>
    <button type="submit">Add Payment</button>
  </form>
  <table id="paymentTable">
    <thead>
      <tr><th>ID</th><th>Booking ID</th><th>Amount</th><th>Status</th><th>Actions</th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const API = "http://127.0.0.1:8000";

    async function fetchData(endpoint, tableId) {
      const res = await fetch(`${API}/${endpoint}`);
      const data = await res.json();
      const tbody = document.querySelector(`#${tableId} tbody`);
      tbody.innerHTML = "";
      data.forEach(item => {
        let row = `<tr id="${endpoint}-${item.id}">`;

        if (endpoint === "passengers") {
          row += `<td>${item.id}</td>
            <td><span>${item.name}</span><input type="text" value="${item.name}" style="display:none"></td>
            <td><span>${item.email}</span><input type="email" value="${item.email}" style="display:none"></td>`;
        }

        if (endpoint === "bookings") {
          row += `<td>${item.id}</td>
            <td><span>${item.passenger_id}</span><input type="number" value="${item.passenger_id}" style="display:none"></td>
            <td><span>${item.route}</span><input type="text" value="${item.route}" style="display:none"></td>
            <td><span>${item.seat}</span><input type="text" value="${item.seat}" style="display:none"></td>`;
        }

        if (endpoint === "payments") {
          row += `<td>${item.id}</td>
            <td><span>${item.booking_id}</span><input type="number" value="${item.booking_id}" style="display:none"></td>
            <td><span>${item.amount}</span><input type="number" step="0.01" value="${item.amount}" style="display:none"></td>
            <td><span>${item.status}</span><input type="text" value="${item.status}" style="display:none"></td>`;
        }

        row += `<td>
          <button onclick="enableEdit('${endpoint}', ${item.id})">Edit</button>
          <button onclick="saveEdit('${endpoint}', ${item.id})" style="display:none">Save</button>
          <button onclick="deleteItem('${endpoint}', ${item.id})">Delete</button>
        </td></tr>`;

        tbody.innerHTML += row;
      });
    }

    function enableEdit(endpoint, id) {
      const row = document.getElementById(`${endpoint}-${id}`);
      row.querySelectorAll("span").forEach(s => s.style.display = "none");
      row.querySelectorAll("input").forEach(i => i.style.display = "inline");
      row.querySelector("button:nth-child(1)").style.display = "none"; // Hide Edit
      row.querySelector("button:nth-child(2)").style.display = "inline"; // Show Save
    }

    async function saveEdit(endpoint, id) {
      const row = document.getElementById(`${endpoint}-${id}`);
      const inputs = row.querySelectorAll("input");
      let payload = {};

      if (endpoint === "passengers") {
        payload = { name: inputs[0].value, email: inputs[1].value };
      }
      if (endpoint === "bookings") {
        payload = { passenger_id: parseInt(inputs[0].value), route: inputs[1].value, seat: inputs[2].value };
      }
      if (endpoint === "payments") {
        payload = { booking_id: parseInt(inputs[0].value), amount: parseFloat(inputs[1].value), status: inputs[2].value };
      }

      await fetch(`${API}/${endpoint}/${id}`, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });

      loadAll();
    }

    async function deleteItem(endpoint, id) {
      await fetch(`${API}/${endpoint}/${id}`, { method: "DELETE" });
      loadAll();
    }

    // Forms
    document.getElementById("passengerForm").addEventListener("submit", async e => {
      e.preventDefault();
      const name = document.getElementById("pName").value;
      const email = document.getElementById("pEmail").value;
      await fetch(`${API}/passengers`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ name, email })
      });
      e.target.reset();
      loadAll();
    });

    document.getElementById("bookingForm").addEventListener("submit", async e => {
      e.preventDefault();
      const passenger_id = parseInt(document.getElementById("bPassengerId").value);
      const route = document.getElementById("bRoute").value;
      const seat = document.getElementById("bSeat").value;
      await fetch(`${API}/bookings`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ passenger_id, route, seat })
      });
      e.target.reset();
      loadAll();
    });

    document.getElementById("paymentForm").addEventListener("submit", async e => {
      e.preventDefault();
      const booking_id = parseInt(document.getElementById("payBookingId").value);
      const amount = parseFloat(document.getElementById("payAmount").value);
      const status = document.getElementById("payStatus").value;
      await fetch(`${API}/payments`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ booking_id, amount, status })
      });
      e.target.reset();
      loadAll();
    });

    function loadAll() {
      fetchData("passengers", "passengerTable");
      fetchData("bookings", "bookingTable");
      fetchData("payments", "paymentTable");
    }

    loadAll();
  </script>

</body>
</html>
